<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SafeTravel Guardian ‚Ä¢ Authority Dashboard</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles/authority.css">
</head>
<body>
    <div class="container">
        <!-- Main Header -->
        <header class="dashboard-header">
            <div class="header-content">
                <h1 class="main-title">üö® Emergency Response Dashboard</h1>
                <p class="slogan">Live Monitoring ‚Ä¢ Rapid Response ‚Ä¢ Citizen Safety</p>
            </div>
            <div class="header-controls">
                <div class="user-info">
                    <span id="authorityName">Response Unit</span>
                    <span class="status-indicator online">‚óè ONLINE</span>
                </div>
                <button class="btn logout" onclick="authManager.logout()">Logout</button>
            </div>
        </header>

        <!-- Real-time Stats -->
        <section class="stats-container">
            <h2 class="stats-title">Live Emergency Analytics</h2>
            <div class="stats-grid">
                <div class="stat-box critical">
                    <span class="stat-value critical" id="activeEmergencies">0</span>
                    <span class="stat-label">Active Emergencies</span>
                    <div class="stat-trend" id="emergencyTrend">+0% today</div>
                </div>
                <div class="stat-box online">
                    <span class="stat-value online" id="respondersOnline">0</span>
                    <span class="stat-label">Responders Online</span>
                    <div class="stat-trend" id="responderTrend">100% available</div>
                </div>
                <div class="stat-box response">
                    <span class="stat-value response" id="avgResponseTime">0s</span>
                    <span class="stat-label">Avg Response Time</span>
                    <div class="stat-trend" id="responseTrend">Target: <5s</div>
                </div>
                <div class="stat-box resolved">
                    <span class="stat-value resolved" id="resolvedToday">0</span>
                    <span class="stat-label">Resolved Today</span>
                    <div class="stat-trend" id="resolutionTrend">+0% efficiency</div>
                </div>
            </div>
        </section>

        <!-- Main Content Grid -->
        <div class="content-grid">
            <!-- Live Map Section -->
            <section class="map-section">
                <div class="section-title">
                    <h2>üìç Live Emergency Map - India</h2>
                    <div class="map-controls">
                        <button class="btn primary" onclick="authorityApp.refreshMap()">
                            üîÑ Refresh
                        </button>
                        <button class="btn secondary" onclick="authorityApp.toggleHeatmap()" id="heatmapBtn">
                            üî• Heatmap
                        </button>
                        <button class="btn secondary" onclick="authorityApp.centerOnActive()">
                            üéØ Center Active
                        </button>
                    </div>
                </div>
                <div id="authorityMap"></div>
                <div class="map-legend">
                    <div class="legend-item">
                        <span class="legend-dot critical"></span>
                        <span>Critical Emergency</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-dot medical"></span>
                        <span>Medical Assistance</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-dot security"></span>
                        <span>Security Assistance</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-dot moving"></span>
                        <span>Moving Tourist</span>
                    </div>
                </div>
            </section>

            <!-- Live Emergency Feed -->
            <section class="alerts-section">
                <div class="section-title">
                    <h2>üì° Live SOS Feed</h2>
                    <div class="alert-controls">
                        <select id="emergencyFilter" onchange="authorityApp.filterEmergencies()">
                            <option value="all">All Emergencies</option>
                            <option value="critical">Critical Only</option>
                            <option value="medical">Medical</option>
                            <option value="security">Security</option>
                            <option value="active">Active Only</option>
                        </select>
                        <button class="btn primary" onclick="authorityApp.exportReport()">
                            üìä Export
                        </button>
                    </div>
                </div>
                <div class="emergency-list" id="emergenciesContainer">
                    <!-- Emergency items will be populated here -->
                    <div class="empty-state">
                        <p>No active emergencies</p>
                        <small>All systems monitoring normally</small>
                    </div>
                </div>
            </section>
        </div>

        <!-- Responder Management -->
        <section class="responder-section">
            <div class="section-title">
                <h2>üë• Responder Management</h2>
                <div class="responder-stats">
                    <span id="availableResponders">0 available responders</span>
                    <span class="response-time">Avg Response: <span id="currentResponseTime">0s</span></span>
                </div>
            </div>
            <div class="responder-list" id="responderList">
                <!-- Responder items will be populated here -->
            </div>
        </section>

        <!-- Analytics Dashboard -->
        <section class="analytics-section">
            <div class="section-title">
                <h2>üìà Analytics & Reporting</h2>
                <div class="analytics-controls">
                    <select id="timeRange" onchange="authorityApp.updateAnalytics()">
                        <option value="today">Today</option>
                        <option value="week">This Week</option>
                        <option value="month">This Month</option>
                    </select>
                    <button class="btn primary" onclick="authorityApp.generateReport()">
                        üìã Generate Report
                    </button>
                </div>
            </div>
            <div class="analytics-grid">
                <div class="analytics-card">
                    <h4>Emergency Types</h4>
                    <div class="chart-container">
                        <canvas id="typeChart"></canvas>
                    </div>
                </div>
                <div class="analytics-card">
                    <h4>Response Times</h4>
                    <div class="chart-container">
                        <canvas id="responseChart"></canvas>
                    </div>
                </div>
                <div class="analytics-card">
                    <h4>Hourly Activity</h4>
                    <div class="chart-container">
                        <canvas id="activityChart"></canvas>
                    </div>
                </div>
                <div class="analytics-card">
                    <h4>Success Metrics</h4>
                    <div class="metrics-grid">
                        <div class="metric-item">
                            <span class="metric-value" id="successRate">0%</span>
                            <span class="metric-label">Success Rate</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-value" id="avgResolution">0m</span>
                            <span class="metric-label">Avg Resolution</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-value" id="satisfaction">0%</span>
                            <span class="metric-label">Satisfaction</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Emergency Details Modal -->
    <div id="emergencyModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h3 id="modalTitle">Emergency Details</h3>
                <span class="close" onclick="authorityApp.closeModal()">&times;</span>
            </div>
            <div class="emergency-details">
                <div class="detail-row">
                    <span class="detail-label">Emergency Type:</span>
                    <span class="detail-value" id="detailType">-</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Tourist:</span>
                    <span class="detail-value" id="detailTourist">-</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Location:</span>
                    <span class="detail-value" id="detailLocation">-</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Coordinates:</span>
                    <span class="detail-value" id="detailCoordinates">-</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Time Reported:</span>
                    <span class="detail-value" id="detailTime">-</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Status:</span>
                    <span class="detail-value" id="detailStatus">-</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Assigned To:</span>
                    <span class="detail-value" id="detailAssigned">-</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Last Update:</span>
                    <span class="detail-value" id="detailLastUpdate">-</span>
                </div>
            </div>
            <div class="action-buttons">
                <button class="btn primary" onclick="authorityApp.assignResponder()">
                    üöë Assign Responder
                </button>
                <button class="btn secondary" onclick="authorityApp.contactTourist()">
                    üìû Contact Tourist
                </button>
                <button class="btn success" onclick="authorityApp.resolveEmergency()">
                    ‚úÖ Resolve Emergency
                </button>
                <button class="btn warning" onclick="authorityApp.centerOnTourist()">
                    üéØ Track Movement
                </button>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/emergency-broadcast.js"></script>
    <script src="js/authority-app.js"></script>
</body>
</html>
